# CAN 통신 에러 처리 메커니즘 강의 정리

## 1. CAN 통신의 신뢰성 필요성

### 자동차 통신의 특수성
- 자동차 부품의 오작동은 생명과 직결되는 심각한 문제
- 차량용 통신에는 높은 신뢰성 요구
- 안전성이 가장 중요한 설계 요소

### CAN 통신의 신뢰성 확보 방법
- 고장 감지 메커니즘을 프로토콜에 내장
- 고장 감지 시 CAN 컨트롤러의 적절한 대응 방법 정의
- 반복적인 고장 발생 시 처리 방법 규정
- 체계적인 에러 처리를 통한 통신 신뢰성 확보

<br>

## 2. 고장 감지의 예시

### 송신 측 에러 감지
- **비트 에러 감지**: 데이터 1을 보내야 하는데 0으로 잘못 전송
- **역방향 비트 에러**: 데이터 0을 보내야 하는데 1로 잘못 전송
- **메시지 포맷 준수 검증**: 정해진 CAN 메시지 포맷을 벗어나지 않았는지 확인

### CAN 메시지 포맷 구조
```
[ID] -> [DLC] -> [Data] -> [기타 필드들]
```
- ID: 메시지 식별자
- DLC: 데이터 길이 코드
- Data: 실제 전송 데이터
- 정해진 포맷을 준수해야 정상 통신 가능

### 수신 측 에러 감지
- **수신 데이터 검증**: 송신 측에서 1을 보냈는데 0으로 해석했는지 확인
- **데이터 무결성 검증**: 전송 과정에서 데이터 변조 여부 확인

<br>

## 3. CAN 에러의 종류

### 에러 감지 항목들
CAN 프로토콜에서 감지하는 주요 에러 유형들:
- 비트 에러 (Bit Error)
- 스터프 에러 (Stuff Error)
- CRC 에러 (CRC Error)
- 폼 에러 (Form Error)
- 어크놀리지 에러 (Acknowledge Error)

### 에러 처리 메커니즘
- 각 에러 유형별로 정의된 감지 방법
- 에러 감지 시 자동 처리 절차
- 반복 에러 발생 시 단계적 대응 방안

<br>

## 4. 고장 방지 메커니즘 (복습)

### Differential Signaling 방식
- **CAN HIGH**와 **CAN LOW** 두 개의 신호선 사용
- 두 전선 간의 전압 차이로 데이터 표현
- 노이즈 내성이 뛰어난 통신 방식

### 노이즈 내성의 원리
1. **노이즈 발생**: 외부 간섭으로 인한 전압 변동
2. **동일한 영향**: CAN HIGH와 CAN LOW에 동일하게 적용
3. **차동 계산**: 두 신호의 차이를 계산하는 과정에서 노이즈 상쇄
4. **신호 복원**: 원래 신호 복원으로 안정적인 통신 유지

### 예방적 접근 방식
- 고장 발생 자체를 원천적으로 차단
- 물리적 신호 전송 방식의 개선
- 환경적 간섭 요소에 대한 강인성 확보

<br>

## 5. 에러 감지와 처리의 중요성

### 다층적 보안 체계
- **1차 방어**: 고장 방지 메커니즘 (Differential Signaling)
- **2차 방어**: 고장 감지 및 처리 메커니즘
- 방지책이 있어도 발생할 수 있는 에러에 대한 대비

### 실시간 대응 시스템
- 에러 발생 즉시 감지
- 자동화된 에러 처리 절차
- 시스템 안정성 유지를 위한 능동적 대응

<br>

## 6. CAN 컨트롤러의 자동 처리

### CAN 컨트롤러의 역할
- **MCU 내부 페리페럴**: 마이크로컨트롤러 유닛 내부의 전용 하드웨어
- **자동 에러 감지**: 소프트웨어 개입 없이 하드웨어 레벨에서 에러 감지
- **자동 에러 처리**: 정의된 프로토콜에 따른 자동 대응

### 개발자의 부담 경감
- **하드웨어 자동화**: 개발자가 별도로 에러 감지 코드를 구현할 필요 없음
- **프로토콜 준수**: CAN 표준에 따른 자동 처리로 일관성 보장
- **신뢰성 향상**: 사람의 실수 가능성 배제

<br>

## 7. 개발자가 알아야 할 핵심 내용

### 버스오프 (Bus-Off) 상태
- **발생 조건**: 에러가 계속 반복될 때 도달하는 상태
- **컨트롤러 알림**: CAN 컨트롤러가 MCU에게 상태 변화 알림
- **소프트웨어 대응**: 개발자가 구현해야 할 핵심 부분

### 개발자의 책임 범위
```
에러 감지 (CAN 컨트롤러 자동) -> 에러 처리 (CAN 컨트롤러 자동) -> 버스오프 알림 -> 소프트웨어 대응 (개발자 구현)
```

### 실무 관점에서의 우선순위
- **상세 에러 유형**: 알아두면 좋지만 필수는 아님
- **버스오프 처리**: 반드시 구현해야 할 핵심 기능
- **전체적인 에러 처리 흐름**: 시스템 설계 시 고려사항

<br>

## 8. 핵심 요약

### CAN 에러 처리의 핵심 원칙
1. **자동차 안전성**: 생명과 직결되는 통신 신뢰성
2. **다층 방어**: 방지 + 감지 + 처리의 종합적 접근
3. **하드웨어 자동화**: CAN 컨트롤러의 자동 에러 처리
4. **소프트웨어 대응**: 버스오프 등 중요 상황에 대한 개발자 구현

### 개발자가 기억해야 할 요점
- 에러 감지와 기본 처리는 CAN 컨트롤러가 자동 수행
- 개발자는 버스오프 상태 등 중요한 상황에 대한 대응 로직 구현
- 개별 에러 유형보다는 전체적인 에러 처리 흐름 이해가 우선
- 실무에서는 CAN 표준의 자동화된 메커니즘을 신뢰하고 활용