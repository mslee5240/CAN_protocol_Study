# CAN 종단저항

## 종단저항의 필요성

### 신호 반사 현상
- **전기 신호**: CAN 통신은 전선을 통한 전기적 신호로 데이터 전송
- **반사파 발생**: 버스 양 끝단에서 신호가 반사
- **신호 왜곡**: 새로운 신호와 반사파가 만나 신호 품질 저하
- **통신 장애**: 왜곡된 신호로 인한 데이터 오류

### 종단저항의 역할
- **반사 방지**: 신호 끝단에서의 반사 최소화
- **신호 품질 향상**: 깨끗한 디지털 신호 유지
- **통신 안정성**: 오류 없는 데이터 전송 보장

<br>

## CAN 표준 종단저항

### 기본 규격
- **저항값**: 120Ω ± 5%
- **위치**: 버스 양 끝단에 각각 하나씩
- **총 저항**: 두 개의 120Ω 병렬 연결로 60Ω 형성

### 120Ω 선택 이유
- **특성 임피던스**: CAN 케이블의 특성 임피던스와 매칭
- **ISO 11898 표준**: 국제 표준에서 규정
- **최적화**: 신호 무결성과 전력 소모의 균형점

<br>

## 완성된 네트워크에서의 종단저항

### 일반적인 상황
- **기존 네트워크**: 이미 구축된 CAN 버스 사용
- **종단저항 설치**: 버스 제작 시 양단에 이미 설치됨
- **개발자 고려사항**: 별도의 종단저항 추가 불필요

### 네트워크 참여 방법
- 기존 버스에 커넥터 연결만으로 참여 가능
- 추가 종단저항 설치하면 안됨 (과도한 부하)
- 플러그 앤 플레이 방식

<br>

## 개발 환경에서의 종단저항

### 개발 상황의 특성
- **단독 개발**: 하나의 제어기만 개발
- **시뮬레이션 장비**: 다른 제어기 역할 대체
- **최소 네트워크**: 제어기 + 시뮬레이션 장비

### 1대1 연결 시 필요성
- **네트워크 구성**: 제어기와 시뮬레이션 장비가 전체 네트워크
- **양단 종료**: 각각이 네트워크의 끝단이 됨
- **종단저항 필요**: 정상 동작을 위해 반드시 설치

<br>

## 120Ω 종단저항 커넥터

### 상용 제품
- **형태**: D-Sub 9핀 커넥터 모양
- **내장 저항**: 커넥터 내부에 120Ω 저항 내장
- **표시**: "CAN 120Ω" 스티커 부착
- **연결 방법**: 제어기 CAN 포트에 직접 연결

### 제품 선택 시 주의사항
- **정확한 저항값**: 120Ω ± 5% 범위 확인
- **핀 배치**: 2번(CAN_L), 7번(CAN_H) 핀 간 연결
- **품질**: 접촉 저항이 낮은 제품 선택

<br>

## 실무에서의 주의사항

### 스티커 식별 문제
- **스티커 탈락**: 사용 중 "CAN 120Ω" 스티커 벗겨짐
- **구분 어려움**: 일반 커넥터와 종단저항 커넥터 혼동
- **통신 장애**: 잘못된 커넥터 사용 시 통신 불가

### 문제 해결 방법
- **멀티미터 측정**: 2번-7번 핀 간 저항값 확인
- **별도 보관**: 종단저항 커넥터 전용 보관함 사용
- **라벨링**: 영구 마커로 추가 표시

<br>

## 종단저항 관련 문제점

### 종단저항 없을 때
- **신호 반사**: 고주파 성분에서 심각한 왜곡
- **통신 오류**: 간헐적 또는 지속적 통신 실패
- **거리 제약**: 통신 가능 거리 단축

### 잘못된 종단저항 사용 시
- **과도한 부하**: 60Ω 미만으로 부하 증가
- **신호 감쇠**: 신호 세기 감소
- **전력 소모**: 불필요한 전력 낭비

### 종단저항 부족 시
- **부분적 종료**: 한쪽 끝만 종료된 경우
- **성능 저하**: 완전하지 않은 반사 방지
- **신뢰성 감소**: 환경 변화에 민감

<br>

## 측정 및 검증 방법

### 저항값 측정
- **장비**: 디지털 멀티미터
- **측정점**: CAN_H와 CAN_L 핀 간
- **정상값**: 60Ω (120Ω 두 개 병렬)

### 신호 품질 확인
- **오실로스코프**: 신호 파형 관찰
- **아이 다이어그램**: 신호 품질 정량 평가
- **BER 테스트**: 비트 오류율 측정

<br>

## 네트워크 구성별 가이드

### 개발 단계
1. 제어기 + 시뮬레이션 장비: 종단저항 커넥터 사용
2. 제어기 + PC (USB-CAN): 양쪽에 종단저항 필요
3. 벤치 테스트: 임시 네트워크에 종단저항 설치

### 통합 단계
1. 기존 네트워크 참여: 종단저항 추가 금지
2. 새로운 네트워크 구축: 양단에만 설치
3. 분기 네트워크: 메인 버스 기준으로 종료

<br>

## 핵심 요약

1. **120Ω 종단저항**: 버스 양단에 설치하여 신호 반사 방지
2. **개발 환경**: 1대1 연결 시 반드시 종단저항 사용
3. **상용 제품**: D-Sub 커넥터 형태의 종단저항 커넥터 활용
4. **실무 팁**: 스티커 탈락에 주의, 멀티미터로 저항값 확인
5. **총 부하**: 정상 네트워크에서 60Ω 유지