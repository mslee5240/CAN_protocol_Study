# CAN 통신 토폴로지 & 전송 방식

## CAN 통신이란?

CAN(Controller Area Network) 통신은 서로 다른 제어기들이 정보를 주고받는 통신 방식입니다. 무선 통신이 아닌 유선 통신으로, 전선을 통해 전기적 신호를 주고받아 통신을 수행합니다.

<br>

## 기존 점대점 연결 방식의 문제점

### 복잡한 선 연결 구조
- 2개 제어기: 전선 1개 필요
- 3개 제어기: 전선 3개 필요 (기존 1개 + 추가 2개)
- 4개 제어기: 전선 6개 필요 (기존 3개 + 추가 3개)
- 5개 제어기: 전선 10개 필요 (기존 6개 + 추가 4개)
- 6개 제어기: 전선 15개 필요 (기존 10개 + 추가 5개)

### 주요 문제점
1. **복잡성 증가**: 제어기가 늘어날수록 연결 구조가 기하급수적으로 복잡해짐
2. **무게 증가**: 전선이 많아질수록 무게가 늘어나 자동차 연비 저하
3. **관리 어려움**: 어떤 선이 어떤 제어기에 연결되었는지 구분하기 어려움
4. **하드웨어 제약**: MCU의 여분 핀 개수 제한
5. **소프트웨어 수정**: 새로운 연결마다 MCU 소프트웨어 수정 필요

<br>

## CAN 통신의 주요 특징

### 1. 버스형 토폴로지 (Bus Topology)

#### 구조
- 중앙에 **공통 버스(Common Bus)** 배치
- 각 제어기는 버스에 개별적으로 연결
- 점대점 연결 대신 공유 매체 사용

#### 장점
- **단순한 구조**: 복잡한 연결선 제거
- **전선 절약**: 필요한 전선 수 대폭 감소
- **무게 감소**: 자동차 연비 향상
- **확장성**: 제어기 추가/제거 용이
- **관리 편의성**: 선 관리가 간단해짐

#### 단점
- **단일 장애점**: 한 제어기의 고장이 전체 네트워크에 영향
- **공유 매체**: 동시 전송 시 충돌 가능성

### 2. 브로드캐스트 전송 방식 (Broadcast Transmission)

#### 동작 원리
- 메시지 송신 시 **모든 제어기**에게 동시 전달
- 특정 제어기만을 대상으로 하는 유니캐스트 불가능
- 메시지에 **목적지 정보 불포함**

#### 장점
- **확장성**: 새로운 제어기 추가 시 기존 제어기 수정 불필요
- **투명성**: 새 제어기가 기존 메시지를 자동으로 수신 가능
- **단순성**: 복잡한 라우팅 메커니즘 불필요

#### 메시지 처리 방식
- **필요한 정보**: 메시지 수신 후 사용
- **불필요한 정보**: 메시지 무시

<br>

## 고장 대응 메커니즘

### 버스오프 (Bus-Off) 상태
- 제어기가 스스로 고장을 감지
- 고장 감지 시 통신 참여 중단
- 네트워크 전체 마비 방지
- 정상 제어기들 간의 통신 보장

<br>

## 추가 고려사항

### 물리 계층 특성
- **차동 신호**: CAN_H와 CAN_L 두 선을 사용한 차동 전송
- **터미네이션**: 버스 양단에 120Ω 종단 저항 필요
- **노이즈 내성**: 차동 신호로 전자기 간섭에 강함

### 메시지 식별
- **메시지 ID**: 각 메시지는 고유 식별자 보유
- **우선순위**: ID 값이 낮을수록 높은 우선순위
- **중재**: 동시 전송 시 우선순위 기반 충돌 해결

<br>

## 핵심 요약

1. **버스형 토폴로지**: 공통 버스에 모든 제어기 연결
2. **브로드캐스트 방식**: 모든 제어기에게 메시지 동시 전달
3. **단순성과 확장성**: 제어기 추가/제거 용이
4. **고장 격리**: 버스오프 메커니즘으로 네트워크 보호