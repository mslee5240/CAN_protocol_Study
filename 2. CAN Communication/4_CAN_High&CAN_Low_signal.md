# CAN High & CAN Low 신호

## 디지털 데이터 표현 방식

### 기본 개념
- **디지털 통신**: 모든 정보를 0과 1의 조합으로 표현
- **전기적 신호**: 전선을 통한 전압 변화로 데이터 전송
- **차동 신호**: 두 선의 전압차를 이용한 신호 표현

<br>

## CAN 신호 표현 방법

### 차동 신호 방식
CAN 통신은 **CAN_H(High)**와 **CAN_L(Low)** 두 선의 전압차로 데이터를 표현합니다.

### 논리 상태별 전압 레벨

#### 논리 '0' (Dominant 상태)
- **조건**: (CAN_H - CAN_L) = 0.9V ~ 5.0V
- **표준 값**:
  - CAN_H: 3.75V
  - CAN_L: 1.25V
  - 전압차: 2.5V
- **특성**: 우선순위 높음

#### 논리 '1' (Recessive 상태)
- **조건**: (CAN_H - CAN_L) = -0.1V ~ 0.5V
- **표준 값**:
  - CAN_H: 2.5V
  - CAN_L: 2.5V
  - 전압차: 0V
- **특성**: 우선순위 낮음

<br>

## Dominant와 Recessive 개념

### 용어 정의
- **Dominant**: 지배적, 우세한 상태 (논리 '0')
- **Recessive**: 열성적, 후퇴하는 상태 (논리 '1')

### 우선순위 원리
- **Dominant 우선**: 여러 노드가 동시 전송 시 Dominant가 승리
- **Wired-AND 로직**: 하나라도 Dominant면 버스 전체가 Dominant
- **충돌 해결**: 자동적인 버스 중재 메커니즘

### 실제 동작 예시
```
1번 제어기: Dominant (0) 출력
2번 제어기: Recessive (1) 출력
3번 제어기: Recessive (1) 출력
4번 제어기: Recessive (1) 출력
→ 결과: 버스 전체에 Dominant (0) 신호
```

<br>

## 차동 신호의 장점

### 노이즈 내성 (Common Mode Noise Rejection)

#### 단일 신호선의 문제점
- **노이즈 영향**: 외부 노이즈가 직접 신호에 영향
- **임계값 문제**: 노이즈로 인한 논리 레벨 오판
- **예시**:
  ```
  원래 신호: 0.5V (논리 0)
  노이즈 추가: +3V
  결과 신호: 3.5V (논리 1로 오판)
  ```

#### 차동 신호의 해결책
- **동일 노이즈**: CAN_H와 CAN_L에 동일한 노이즈 유입
- **차동 계산**: 노이즈 성분이 상쇄됨
- **예시**:
  ```
  노이즈 없을 때: CAN_H(3.75V) - CAN_L(1.25V) = 2.5V
  노이즈 +3V 시: CAN_H(6.75V) - CAN_L(4.25V) = 2.5V
  ```

### 전자기 간섭(EMI) 저항성
- **방출 감소**: 차동 신호로 EMI 방출 최소화
- **수신 강화**: 외부 EMI에 대한 내성 향상
- **자동차 환경**: 엔진, 점화 시스템 등의 강한 노이즈 환경에 적합

<br>

## 트위스트 페어 케이블

### 물리적 구조
- **꼬임 구조**: CAN_H와 CAN_L 선을 나선형으로 꼬임
- **꼬임 피치**: 일정한 간격으로 반복되는 꼬임
- **차폐**: 필요시 전체적으로 차폐 처리

### 노이즈 억제 원리
- **균등한 노이즈 유입**: 꼬임으로 인해 두 선에 동일한 노이즈 영향
- **자기장 상쇄**: 각 선에서 발생하는 자기장이 상호 상쇄
- **크로스토크 감소**: 인접 선로와의 간섭 최소화

### 실제 적용
- **자동차 하네스**: 대부분의 CAN 케이블이 트위스트 페어 구조
- **식별 방법**: 두 선이 꼬여있으면 CAN 케이블일 가능성 높음
- **산업 표준**: ISO 11898에서 권장하는 구조

<br>

## CAN 트랜시버 역할

### 논리-물리 변환
- **MCU 출력**: 3.3V 또는 5V 논리 레벨
- **트랜시버 기능**: 논리 레벨을 CAN 차동 신호로 변환
- **양방향 변환**: 송신 및 수신 모두 처리

### 주요 기능
- **레벨 변환**: 디지털 로직 ↔ CAN 차동 신호
- **드라이버 능력**: 버스 구동을 위한 충분한 전류 공급
- **보호 회로**: 과전압, 단락 등으로부터 MCU 보호

<br>

## 신호 품질 고려사항

### 케이블 특성
- **특성 임피던스**: 120Ω ± 5%
- **케이블 길이**: 최대 1km (저속), 40m (고속)
- **신호 감쇠**: 거리에 따른 신호 세기 감소

### 환경 요인
- **온도 변화**: 전기적 특성 변화
- **습도**: 절연 저항 변화
- **진동**: 접촉 불량 가능성

<br>

## 신호 측정 및 디버깅

### 측정 장비
- **오실로스코프**: 차동 프로브 사용
- **CAN 애널라이저**: 프로토콜 레벨 분석
- **멀티미터**: DC 전압 및 저항 측정

### 일반적인 문제
- **종단저항 누락**: 신호 반사로 인한 왜곡
- **케이블 단선**: 한쪽 선의 연결 불량
- **노이즈 유입**: 차폐 불량 또는 그라운드 문제

<br>

## 표준 및 규격

### ISO 11898 표준
- **물리 계층**: 차동 신호 레벨 정의
- **전압 범위**: Dominant/Recessive 구분 기준
- **타이밍**: 비트 타이밍 및 샘플링 점

### 자동차 특화 표준
- **ISO 11898-2**: 고속 CAN (125kbps ~ 1Mbps)
- **ISO 11898-3**: 저속 CAN (최대 125kbps)
- **SAE J1939**: 상용차 CAN 네트워킹

<br>

## 핵심 요약

1. **차동 신호**: CAN_H와 CAN_L의 전압차로 데이터 표현
2. **Dominant(0) > Recessive(1)**: 우선순위 기반 버스 중재
3. **노이즈 내성**: 차동 신호 방식으로 강한 노이즈 환경에 적합
4. **트위스트 페어**: 꼬인 케이블로 EMI 및 노이즈 최소화
5. **표준 전압**: Dominant 시 약 2.5V 차이, Recessive 시 약 0V 차이