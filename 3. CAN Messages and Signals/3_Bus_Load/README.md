# 버스 로드 강의 요약

## 1. 버스 로드의 정의

### 기본 개념
- **버스 로드(Bus Load)** = 네트워크 점유율을 나타내는 지표
- 단위: **퍼센트(%)** - 축구의 볼 점유율과 유사한 개념
- 일정 시간 동안 **실제 메시지 전송 시간의 비율**

### 계산 공식
```
버스 로드(%) = (실제 메시지 전송 시간 / 전체 관찰 시간) × 100
```

## 2. 버스 로드 계산 예시

### 예시 1: 기본 계산
```
관찰 시간: 5초
메시지 1개 전송 시간: 1초
전송된 메시지 수: 1개

버스 로드 = (1초 / 5초) × 100 = 20%
```

### 예시 2: 복수 메시지
```
관찰 시간: 5초  
메시지 1개 전송 시간: 1초
전송된 메시지 수: 2개

총 전송 시간 = 2개 × 1초 = 2초
버스 로드 = (2초 / 5초) × 100 = 40%
```

### 예시 3: 포화 상태
```
관찰 시간: 5초
메시지 1개 전송 시간: 1초  
전송된 메시지 수: 5개

총 전송 시간 = 5개 × 1초 = 5초
버스 로드 = (5초 / 5초) × 100 = 100% (포화)
```

## 3. 버스 로드가 높을 때의 문제점

### 문제 1: 메시지 전송 불가
- **버스 로드 100%** 도달 시 추가 메시지 전송 불가
- 우선순위가 낮은 메시지는 **전송 기회 상실**
- 네트워크 **포화 상태**로 인한 통신 마비

### 문제 2: 전송 딜레이 발생

#### 딜레이 발생 시나리오
```
상황: 4개 제어기의 동시 메시지 전송 시도
우선순위: 1번 > 2번 > 3번 > 4번

실제 전송 순서:
1번 메시지 → 2번 메시지 → 3번 메시지 → 4번 메시지
```

#### 4번 제어기의 딜레이 상황
- **원하는 동작**: 즉시 메시지 전송
- **실제 동작**: 1, 2, 3번 메시지 완료까지 대기
- **결과**: 타이밍적 딜레이 발생

### 버스 로드와 문제 발생 확률
- **버스 로드 ↑** → **딜레이 발생 확률 ↑**
- **버스 로드 100%** → **메시지 전송 불가**

## 4. 버스 로드 관리의 필요성

### 제조사 요구사항
- 차량 제조사에서 **버스 로드 제약 조건** 제시
- 일반적 요구사항: **"버스 로드 50% 미만 유지"**
- 개발자는 해당 사양을 **반드시 준수**해야 함

### 관리 목표
- **실시간 통신** 보장
- **메시지 손실** 방지  
- **예측 가능한 응답 시간** 확보

## 5. 버스 로드 측정 방법

### CANoe 도구 활용
- **Vector Informatik사의 CAN 계측 도구**
- CAN 네트워크 **메시지 계측 및 시뮬레이션** 기능
- **실시간 버스 로드 표시** (예: "현재 버스 로드 25%")

### 기타 측정 도구
- 대부분의 **CAN 통신 장비**가 버스 로드 측정 기능 제공
- **실시간 모니터링** 및 **히스토리 분석** 가능
- **개발 단계별 성능 검증** 필수

## 6. 버스 로드 최적화 방법

### 방법 1: 메시지 크기 최소화

#### 원리
- **데이터 크기 ↓** → **메시지 크기 ↓** → **전송 시간 ↓**
- 메시지 하나당 전송 시간 단축으로 **전체 버스 로드 감소**

#### 적용 기법
- 불필요한 데이터 제거
- 비트 패킹으로 공간 효율성 증대
- Factor/Offset 기법으로 데이터 압축

### 방법 2: 전송 주기 조정

#### 주기별 버스 로드 변화 예시
```
시나리오: 메시지 전송 시간 1초

주기 1초: 1초마다 1초 전송 → 버스 로드 100%
주기 2초: 2초마다 1초 전송 → 버스 로드 50%
주기 4초: 4초마다 1초 전송 → 버스 로드 25%
```

#### 주기 설정 시 고려사항
- **너무 빠른 주기**: 버스 로드 증가 → 네트워크 포화 위험
- **너무 느린 주기**: 데이터 신선도 저하 → 시스템 응답성 악화
- **적절한 균형점** 찾기가 핵심

### 최적화 방법 비교
| 방법 | 장점 | 단점 | 적용 상황 |
|------|------|------|-----------|
| **메시지 크기 감소** | 즉각적 효과, 전송 효율성 향상 | 데이터 손실 위험, 구현 복잡성 | 압축 가능한 데이터 |
| **주기 조정** | 구현 간단, 즉시 적용 가능 | 실시간성 저하 가능 | 실시간성이 상대적으로 덜 중요한 데이터 |

## 7. 실무 적용 가이드

### 설계 단계 고려사항
1. **제조사 요구사항 확인** (예: 버스 로드 50% 미만)
2. **각 메시지의 전송 주기 및 크기 계획**
3. **이론적 버스 로드 계산 및 검증**
4. **안전 마진 확보** (예: 목표치의 80% 수준으로 설계)

### 개발 단계 모니터링
- **실시간 버스 로드 측정**
- **부하 테스트** 수행
- **최악 시나리오** 검증
- **성능 한계점** 파악

### 문제 해결 프로세스
1. **버스 로드 측정** 및 **임계치 초과 확인**
2. **메시지별 기여도 분석**
3. **우선순위 재검토** 및 **최적화 방안 수립**
4. **메시지 크기 축소** 또는 **주기 조정** 적용
5. **효과 검증** 및 **지속적 모니터링**

## 8. 핵심 정리

### 버스 로드 관리의 핵심 원칙
1. **네트워크 사용률을 나타내는 핵심 지표**
2. **일정 시간 동안 실제 메시지 전송 시간의 비율**
3. **높은 버스 로드는 딜레이와 전송 불가 문제 야기**

### 관리 방법
- **메시지 크기 최소화**: 데이터 압축 및 효율적 패킹
- **전송 주기 최적화**: 실시간성과 버스 로드의 균형
- **지속적 모니터링**: CANoe 등 도구를 활용한 실시간 측정

### 실무 적용 포인트
- **제조사 요구사항 준수** (일반적으로 50% 미만)
- **설계 단계부터 체계적 계획** 수립
- **개발 과정에서 지속적 검증**
- **적절한 안전 마진** 확보

버스 로드 관리는 **CAN 네트워크의 성능과 안정성을 결정하는 핵심 요소**이며, 체계적인 설계와 지속적인 모니터링을 통해 최적의 통신 환경을 구축할 수 있습니다.