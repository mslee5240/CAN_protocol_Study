# 시그널과 Data Length Code 강의 요약

## 1. 시그널(Signal)의 개념

### 시그널이란?
- **메시지 내부의 구체적인 데이터**를 나타내는 개념
- CAN DB의 메시지 이름은 단순한 식별용이고, **실제 데이터 내용은 시그널로 정의**
- 하나의 메시지 안에 **여러 개의 시그널** 포함 가능

### 시그널 예시
#### Battery Status 메시지 (ID: 0x123)
```
시그널 1: 배터리 전압 (예: 5V)
시그널 2: 배터리 용량 (예: 300Wh)  
시그널 3: 최대 허용 전류 (예: 10A)
```

#### Engine Status 메시지
```
시그널 1: 엔진 최대 RPM
시그널 2: 현재 RPM
시그널 3: 엔진 온도
```

### 시그널의 역할
- **송신측**: 구체적인 센서 값들을 시그널로 구성하여 전송
- **수신측**: 시그널 정보를 통해 데이터의 의미 파악 및 활용

## 2. 시그널 데이터의 저장 위치

### CAN 메시지 구조에서의 위치
- 시그널 값들은 CAN 메시지의 **데이터(Data) 영역**에 저장
- 데이터 영역 = **실제 전송하고자 하는 정보**가 담기는 공간

### 데이터 영역의 특징
- **최대 크기**: 8바이트
- **가변 크기**: 1~8바이트 범위에서 조정 가능
- **단위 표시**: 다른 필드는 비트 단위, 데이터 영역만 **바이트 단위**

## 3. Data Length Code (DLC)

### DLC의 정의
- **Data Length Code** = 데이터 영역의 길이를 나타내는 필드
- **4비트 크기**로 0~8의 값 표현 가능
- 수신자에게 **데이터 영역의 정확한 크기** 알림

### DLC의 필요성
- CAN 메시지의 데이터 영역은 **가변 길이**
- 수신측에서 **어디까지가 유효한 데이터인지** 알아야 함
- **메시지 해석의 정확성** 보장

### DLC 사용 예시
```
메시지 1: 데이터 8바이트 → DLC = 8
메시지 2: 데이터 4바이트 → DLC = 4  
메시지 3: 데이터 2바이트 → DLC = 2
```

## 4. CAN DB의 확장된 정보

### 기존 CAN DB vs 확장된 CAN DB
| 기존 정보 | 확장된 정보 |
|-----------|-------------|
| 메시지 ID | **+ 데이터 길이** |
| 메시지 이름 | **+ 시그널 목록** |
| 송신/수신 제어기 | **+ 시그널 상세 속성** |

### 데이터 길이 정보 추가
- 각 메시지마다 **정확한 데이터 크기** 명시
- 송신측은 **DLC 값 설정**의 기준
- 수신측은 **데이터 해석 범위** 결정

## 5. 메시지 수신 시의 문제점과 해결

### 문제 상황
```
수신된 메시지: ID 0x123, 데이터 4바이트
문제: "이 4바이트가 구체적으로 무엇을 의미하는가?"
```

### 해결 방안: 시그널 정보의 DB 저장
- **각 메시지별 시그널 목록** CAN DB에 명시
- **시그널의 구체적 의미** 설명
- **데이터 해석 방법** 제공

### 주의사항
- DB에 저장되는 것은 **시그널 정의**이지 실제 값이 아님
- 예시의 5V, 300Wh, 10A는 **설명용 샘플 값**
- 실제 전송되는 값은 **측정 시점마다 변함**

## 6. 시그널의 상세 속성 정보

### 비트 단위 데이터 할당
- CAN DB에서 시그널 위치는 **비트 단위**로 정의
- 4바이트 = 32비트를 비트별로 세분화하여 할당

### 데이터 할당 예시 (4바이트 메시지)
```
비트 위치    할당 시그널
0-6비트     배터리 전압 (7비트)
7-13비트    최대 전류 (7비트)  
14-31비트   배터리 용량 (18비트)
```

### 비트 할당의 시각적 표현
```
바이트 1: [0][1][2][3][4][5][6][7]  ← 전압(0-6) + 전류 시작(7)
바이트 2: [8][9][10][11][12][13][14][15] ← 전류(8-13) + 용량 시작(14-15)
바이트 3: [16][17][18][19][20][21][22][23] ← 용량 계속
바이트 4: [24][25][26][27][28][29][30][31] ← 용량 계속
```

## 7. Start Bit와 Length 속성

### Start Bit (시작 비트)
- 해당 시그널이 **시작되는 비트 위치**
- **0부터 시작**하는 절대 위치
- 데이터 영역 내에서의 **정확한 시작점** 명시

### Length (길이)
- 해당 시그널이 **차지하는 비트 수**
- **비트 단위**로 표현 (바이트가 아님)
- 시그널의 **데이터 크기** 결정

### CAN DB 표기 예시
| 시그널명 | Start Bit | Length | Unit | Comment |
|----------|-----------|--------|------|---------|
| Battery Voltage | 0 | 7 | V | 배터리 전압 |
| Maximum Current | 7 | 7 | A | 최대 허용 전류 |
| Battery Capacity | 14 | 18 | Wh | 배터리 용량 |

### 추가 속성들
- **Unit**: 시그널의 물리적 단위 (V, A, Wh 등)
- **Comment**: 시그널에 대한 상세 설명 (선택사항)
- **Factor/Offset**: 다음 강의에서 설명 예정

## 8. CAN DB의 완전한 구조

### 메시지 레벨 정보
```
- 메시지 ID (예: 0x123)
- 메시지 이름 (예: Battery Status)  
- 데이터 길이 (예: 4바이트)
- 송신 제어기 (예: BMS)
- 수신 제어기 (예: Engine, Airbag)
```

### 시그널 레벨 정보
```
각 메시지마다:
- 포함된 시그널 목록
- 각 시그널의 Start Bit
- 각 시그널의 Length
- 각 시그널의 Unit
- 각 시그널의 Comment
- 각 시그널의 Factor/Offset
```

## 9. 실제 CAN 통신 과정

### 송신 과정 (BMS 제어기)
1. **CAN DB 참조**: ID 0x123 메시지 정보 확인
2. **메시지 헤더 구성**: ID = 0x123, DLC = 4
3. **시그널 값 측정**: 전압, 전류, 용량 센서 읽기
4. **데이터 배치**: Start Bit와 Length에 따라 4바이트 데이터 구성
5. **메시지 전송**: 완성된 CAN 메시지 네트워크에 송신

### 수신 과정 (에어백 제어기)
1. **메시지 수신**: 네트워크에서 CAN 메시지 받음
2. **ID 확인**: 0x123 → CAN DB에서 Battery Status로 식별
3. **DLC 확인**: 4바이트 데이터 영역 크기 파악
4. **시그널 정보 참조**: CAN DB에서 시그널 배치 정보 확인
5. **데이터 해석**: Start Bit/Length 기반으로 각 시그널 값 추출
6. **정보 활용**: 추출된 배터리 정보를 시스템에서 활용

### 통신 성공의 핵심
- **송수신 양측의 동일한 CAN DB 사용**
- **정확한 시그널 배치 정보** 공유
- **일관된 데이터 해석 방식** 적용

## 10. 핵심 정리

### 시그널의 중요성
- **메시지의 실제 내용**을 구성하는 핵심 요소
- **데이터의 의미**를 명확히 정의
- **송수신 간의 정보 공유** 기준 제공

### DLC의 역할
- **가변 길이 데이터**의 정확한 크기 전달
- **메시지 해석의 정확성** 보장
- **네트워크 효율성** 향상 (필요한 만큼만 전송)

### CAN DB의 진화
```
기본 CAN DB: 메시지 ID + 이름 + 송수신자
↓
확장된 CAN DB: + 데이터 길이 + 시그널 목록 + 시그널 속성
```

### 실무 적용 포인트
- **비트 단위의 정밀한 데이터 설계** 필요
- **Start Bit와 Length의 정확한 계산** 중요
- **Factor/Offset 등 고급 기능** 활용 (다음 강의 예정)
- **송수신 양측의 CAN DB 동기화** 필수
