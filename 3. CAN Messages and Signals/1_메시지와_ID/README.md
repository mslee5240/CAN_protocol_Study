# CAN 메시지 ID

## 1. CAN 메시지의 기본 구조

### 브로드캐스트 방식의 문제점
- CAN 통신은 모든 메시지를 **브로드캐스트 방식**으로 전송
- 메시지 내부에 **송신자/수신자 정보가 없음** (source address, destination address 부재)
- 인터넷 프로토콜과 달리 IP 주소 같은 주소 체계가 없음

### 문제 상황
- 모든 제어기가 네트워크의 모든 메시지를 수신
- 메시지를 받아도 **누가 보냈는지, 어떤 내용인지 알 수 없음**
- 메시지 해석이 불가능한 상황 발생

## 2. CAN 메시지 ID의 역할

### ID 필드의 위치
- CAN 메시지의 **Arbitration 필드**에 위치
- Standard 포맷: **11비트** (ID 0~10)
- 메시지마다 고유한 ID 값을 가짐

### ID의 기능
- 메시지 식별을 위한 **고유 번호**
- 송신자와 메시지 내용을 간접적으로 식별
- 메시지 우선순위 결정에도 활용

## 3. CAN DB (데이터베이스)

### CAN DB의 정의
- **CAN Database**, **Communication Matrix**, **K-Matrix**라고도 불림
- 네트워크에서 사용하는 모든 메시지 정보를 정의한 문서
- 자동차 제조사에서 작성하여 제어기 개발자들에게 제공

### CAN DB 구성 요소
| 항목 | 설명 |
|------|------|
| **Message ID** | 16진수로 표현 (예: 0x123) |
| **Message Name** | 메시지 식별명 (예: Battery Status) |
| **Transmitter** | 송신 제어기 (예: BMS) |
| **Receiver** | 수신 제어기 (예: Engine, Airbag) |
| **Data Length** | 데이터 영역 크기 (1~8바이트) |

### 예시 CAN DB
```
ID: 0x123 | Name: Battery Status  | TX: BMS    | RX: Engine, Airbag
ID: 0x500 | Name: Engine Status   | TX: Engine | RX: BMS, Airbag  
ID: 0x507 | Name: Airbag Status   | TX: Airbag| RX: Engine
```

## 4. 메시지 송수신 구현

### 송신 측 구현
1. CAN DB에서 자신이 보낼 메시지 ID 확인
2. 메시지 ID 영역에 해당 ID 작성
3. 데이터 영역에 실제 데이터 삽입
4. 메시지 전송

### 수신 측 구현
1. 메시지 수신 후 ID 확인
2. CAN DB에서 해당 ID의 메시지 정보 검색
3. 송신자와 데이터 의미 파악
4. 데이터 해석 및 활용

## 5. 중요한 규칙과 제약사항

### ID 중복 금지
- **같은 네트워크에서 동일한 ID를 여러 제어기가 사용하면 안됨**
- ID 중복 시 메시지 해석 오류 발생
- 통신 혼란 및 오동작 야기

### CAN DB의 범위와 독립성
- **네트워크별로 독립적인 CAN DB 존재**
- 자동차 회사별, 차종별, 네트워크별로 서로 다름
- 동일한 ID라도 네트워크가 다르면 완전히 다른 의미

### 기술적 제약 vs 약속
- CAN DB 내용은 **기술적 제약이 아닌 약속**
- 소프트웨어적으로는 다른 ID 송신 가능
- 하지만 약속을 지켜야 정상적인 통신 가능

## 6. 실제 활용 사례

### 개발 과정에서의 활용
- **테스트 메시지**: DB에 없는 별도 ID로 개발 중 사용
- 납품 시 테스트 메시지 제거
- 개발자 간 약속된 규칙 준수 필요

### 수신 제어기 정보의 의미
- 리시버 목록은 **참고 정보**일 뿐
- 브로드캐스트 특성상 모든 제어기가 수신 가능
- 실제로는 필요한 메시지만 선별적으로 활용

## 7. CAN 메시지 ID 포맷

### 두 가지 포맷 지원
| 포맷 | ID 길이 | 특징 |
|------|---------|------|
| **Standard** | 11비트 | 기본 포맷, 2048개 ID 지원 |
| **Extended** | 29비트 | 확장 포맷, 약 5억개 ID 지원 |

### 포맷 사용 규칙
- **하나의 네트워크에서 두 포맷 혼용 가능**
- 네트워크별로 필요에 따라 선택
- 대부분의 경우 Standard 포맷으로 충분

## 8. K-Matrix 명칭의 유래

### 독일어 기원
- Communication → Kommunikation (독일어)
- 첫 글자 'K'에서 **K-Matrix** 명칭 유래
- 독일 자동차 회사들의 표준이 국제 표준화
- 자동차 업계의 독일어 용어 다수 존재

## 9. 핵심 정리

### CAN 메시지 ID의 핵심 역할
1. **메시지 식별**: 누가 보낸 어떤 메시지인지 구분
2. **통신 규칙**: 네트워크 참여자 간의 약속 체계
3. **데이터 해석**: 메시지 내용의 의미 파악 기준

### 개발자가 알아야 할 중요 사항
- CAN DB는 **프로젝트별로 다름** - 정확한 DB 확인 필수
- ID 중복 사용 **절대 금지**
- 약속된 규칙 준수가 **정상 통신의 핵심**
- Standard/Extended 포맷 **혼용 가능**

### 실무 적용 포인트
- 메시지 송신: CAN DB 기반 ID 설정 및 데이터 구성
- 메시지 수신: ID 기반 송신자 식별 및 데이터 해석
- 네트워크 설계: 적절한 ID 할당 및 중복 방지