# CAN 메시지와 시그널 핵심 개념

## 1. 메시지 ID의 역할

### 기본 개념
- **메시지 내용 식별**: CAN 통신에서 메시지 ID는 해당 메시지의 내용이 무엇인지를 구분하는 역할
- **브로드캐스트 방식의 특징**: CAN은 주소 정보가 없는 브로드캐스트 방식이므로 ID로 메시지를 구분
- **콘텐츠 기반 식별**: 송신자나 수신자가 아닌 메시지 내용 자체를 기준으로 식별

### 실용적 활용
- 엔진 RPM, 차속, 온도 등 각각의 데이터 타입마다 고유한 ID 할당
- 수신측에서 필요한 데이터만 선별적으로 수신 가능

## 2. 메시지 우선순위

### 우선순위 결정 방식
- **ID 값 기반**: 메시지 ID 값이 작을수록 높은 우선순위
- **충돌 해결**: 여러 컨트롤러가 동시에 전송 시도할 때 우선순위가 높은 메시지가 먼저 전송
- **자동 중재**: 하드웨어 레벨에서 자동으로 우선순위 판단 및 처리

### 설계 고려사항
- 중요도가 높은 데이터(예: 브레이크, 엔진 제어)에는 낮은 ID 값 할당
- 일반적인 상태 정보에는 높은 ID 값 할당

## 3. Bus Load (버스 부하)

### 정의
- **사용률 지표**: 단위 시간 동안 메시지 전송으로 사용되는 네트워크의 비율
- **성능 지표**: 네트워크가 얼마나 활발하게 사용되고 있는지를 나타내는 척도

### 영향
- **높은 Bus Load**: 메시지 전송 지연 발생 가능
- **네트워크 설계**: 적절한 Bus Load 유지를 위한 메시지 주기 및 데이터량 조절 필요

## 4. 시그널 (Signal)

### 기본 개념
- **메시지 내 데이터 단위**: CAN 메시지의 데이터 영역 안에 포함된 실제 의미 있는 정보
- **세분화된 데이터**: 하나의 메시지 안에 여러 개의 시그널이 포함될 수 있음

### 계층 구조
- **메시지 레벨**: 전체 메시지를 ID로 구분
- **시그널 레벨**: 메시지 내부의 개별 데이터 (전압, 온도, 속도 등)

### 실제 예시
- 엔진 메시지 내에 RPM, 온도, 오일압력 등 여러 시그널 포함
- 각 시그널은 메시지 데이터 영역의 특정 비트 위치에 배치

## 5. Factor와 Offset 인코딩

### 목적
- **효율적 데이터 표현**: 다양한 데이터 타입(정수, 실수)을 효율적으로 표현
- **데이터 압축**: 제한된 CAN 메시지 크기(최대 8바이트) 내에서 데이터 크기 최적화
- **전송 효율성**: 네트워크 대역폭 절약

### 동작 원리
```
실제값 = (전송값 × Factor) + Offset
전송값 = (실제값 - Offset) / Factor
```

### 예시
- 온도 데이터: -40°C ~ 150°C 범위를 0~255로 압축
- Factor = 0.75, Offset = -40
- 실제 온도 20°C → 전송값 = (20 - (-40)) / 0.75 = 80

### 장단점
- **장점**: 데이터 크기 절약, 전송 효율성 향상
- **단점**: 정밀도 손실 가능성, 인코딩/디코딩 과정 필요

## 6. 설계 시 고려사항

### 메시지 설계
- ID 할당 전략 수립 (우선순위 기반)
- Bus Load 예측 및 관리
- 메시지 주기 최적화

### 시그널 설계
- Factor/Offset 값 선택 시 정밀도와 범위 균형
- 메시지 내 시그널 배치 최적화
- 데이터 타입별 적절한 비트 할당

### 네트워크 성능
- 실시간성 요구사항 충족
- 전체 시스템의 Bus Load 관리
- 확장성을 고려한 ID 공간 할당